{
  "entities": {
    "Loan": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Loan",
      "type": "object",
      "description": "Represents a loan application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Loan entity."
        },
        "applicantName": {
          "type": "string",
          "description": "The name of the loan applicant."
        },
        "amount": {
          "type": "number",
          "description": "The loan amount requested."
        },
        "salary": {
          "type": "number",
          "description": "The applicant's salary."
        },
        "paymentTerm": {
          "type": "number",
          "description": "The loan repayment period in months."
        },
        "loanType": {
          "type": "string",
          "description": "The type of loan applied for.",
          "enum": ["Cash Advance", "Multi-Purpose", "Emergency"]
        },
        "purpose": {
          "type": "string",
          "description": "The purpose of the loan.",
          "enum": [
            "Business Capital",
            "Bills Payment",
            "Tuition Fee",
            "House Renovation",
            "Medical Expenses",
            "Travel Expenses"
          ]
        },
        "status": {
          "type": "string",
          "description": "The status of the loan application (e.g., pending, approved, denied, released)."
        },
        "bookkeeperChecked": {
          "type": "boolean",
          "description": "Indicates if the bookkeeper has checked the application."
        },
        "payrollChecked": {
          "type": "boolean",
          "description": "Indicates if the payroll department has checked the application."
        },
        "denialRemarks": {
          "type": "string",
          "description": "Remarks for denying the loan application."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the loan application was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp of when the loan application was last updated.",
          "format": "date-time"
        },
        "releasedAt": {
          "type": "string",
          "description": "Timestamp of when the loan was released.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "applicantName",
        "amount",
        "paymentTerm",
        "loanType",
        "purpose",
        "status",
        "bookkeeperChecked",
        "payrollChecked",
        "createdAt",
        "updatedAt"
      ]
    },
    "Payment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Payment",
      "type": "object",
      "description": "Represents a single payment installment for a loan.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Payment entity."
        },
        "loanId": {
          "type": "string",
          "description": "The ID of the loan this payment belongs to."
        },
        "paymentNumber": {
          "type": "number",
          "description": "The installment number (e.g., 1, 2, 3)."
        },
        "dueDate": {
          "type": "string",
          "description": "The date the payment is due.",
          "format": "date-time"
        },
        "amount": {
          "type": "number",
          "description": "The principal amount for this installment."
        },
        "paymentDate": {
          "type": "string",
          "description": "The actual date the payment was made.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "The status of the payment.",
          "enum": ["pending", "paid"]
        },
        "penalty": {
          "type": "number",
          "description": "Penalty amount incurred for late payment."
        },
        "penaltyWaived": {
          "type": "boolean",
          "description": "Indicates if the penalty was waived."
        }
      },
      "required": [
        "id",
        "loanId",
        "paymentNumber",
        "dueDate",
        "amount",
        "status",
        "penalty",
        "penaltyWaived"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/loans/{loanId}",
        "definition": {
          "entityName": "Loan",
          "schema": {
            "$ref": "#/backend/entities/Loan"
          },
          "description": "Represents a loan application. Includes fields for applicant information, loan status, approval flags, and timestamps.",
          "params": [
            {
              "name": "loanId",
              "description": "Unique identifier for the loan application."
            }
          ]
        }
      },
      {
        "path": "/loans/{loanId}/payments/{paymentId}",
        "definition": {
          "entityName": "Payment",
          "schema": {
            "$ref": "#/backend/entities/Payment"
          },
          "description": "Represents a single payment installment for a loan.",
          "params": [
            {
              "name": "loanId",
              "description": "The ID of the loan this payment belongs to."
            },
            {
              "name": "paymentId",
              "description": "Unique identifier for the payment installment."
            }
          ]
        }
      }
    ],
    "reasoning": "Given the application requirements and the 'admin-only' access for this prototype, a simple flat structure for the `loans` collection will suffice. The focus is on simulating the workflow and UI elements. However, even for a prototype, it's crucial to structure the data in a way that's easily adaptable to more complex security requirements later. This design anticipates the addition of role-based access control in the future.\n\nThe structure prioritizes ease of implementation for the initial prototype while adhering to the principles of Authorization Independence and enabling QAPs.\n\n**Authorization Independence:** Since this is an admin-only prototype, authorization independence is not strictly required now. However, the design anticipates future needs. If role-based access (e.g., bookkeeper, payroll, approver) is implemented, relevant authorization data (e.g., user roles or group memberships) would be denormalized into each loan document to avoid `get()` calls in the security rules. For instance, a `roles` map could be added to each loan document, containing which role has what permissions on the loan.\n\n**QAPs (Rules are not Filters):** Currently, with `allow read, write: if true;`, all `list` operations are permitted. However, when role-based access is introduced, segregation will be important to ensure that specific roles can only access particular subsets of loan data. Using the status field we can ensure that only certain status types are available depending on the role. For example, a bookkeeper may only be able to view loan applications that are pending review."
  }
}
